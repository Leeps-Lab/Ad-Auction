[{"fields": {"name": "Ad Auction Port DEV", "admin_css": "body {\r\n  padding-top: 60px;\r\n}\r\n\r\n", "comments": "", "experimenter": 1, "admin_html": "<!DOCTYPE HTML>\r\n<html ng-app=\"Redwood\">\r\n  <head>\r\n    <title>Ad Auction Port Admin</title>\r\n\t\t<script type=\"text/javascript\" src=\"{{ STATIC_URL }}framework/js/lib/jquery/jquery.min.js\"></script>\r\n\t\t<script type=\"text/javascript\" src=\"{{ STATIC_URL }}framework/js/lib/bootstrap/bootstrap-3.1.1.min.js\"></script>\r\n\t\t<script type=\"text/javascript\" src=\"{{ STATIC_URL }}framework/js/lib/angular/angular-1.2.16.js\"></script>\r\n\t\t<script type=\"text/javascript\" src=\"{{ STATIC_URL }}framework/js/redwoodCore.js\"></script>\r\n\t\t<script type=\"text/javascript\" src=\"{{ STATIC_URL }}framework/js/redwoodHelpers.js\"></script>\r\n\t\t<script type=\"text/javascript\" src=\"{{ STATIC_URL }}framework/js/redwoodAdmin.js\"></script>\r\n\t\t<link type=\"text/css\" rel=\"stylesheet\" href=\"{{ STATIC_URL }}framework/css/bootstrap.min.css\"/>\r\n\t\t<script type=\"text/javascript\">\r\n\t\t\t{{ js }}\r\n\t\t</script>\r\n\t\t<style type=\"text/css\">\r\n\t\t\t{{ css }}\r\n\t\t</style>\r\n\t</head>\r\n\t<body ng-controller=\"AdminCtrl\">\r\n\t\t<div class=\"navbar navbar-fixed-top container\">\r\n\t\t\t<div class=\"navbar-inner\">\r\n\t\t\t\t<div class=\"container-fluid\">\r\n\t\t\t\t\t<div class=\"brand\" href=\"#\">Economics Experiment</div>\r\n\t\t\t\t\t<div class=\"nav-collapse collapse\">\r\n\t\t\t\t\t\t<p class=\"navbar-text pull-right\">Administrator</p>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\r\n\t\t<div class=\"container\">\r\n\t\t\t<div class=\"row\">\r\n\t\t\t\t<div class=\"span3\">\r\n\t\t\t\t\t<div class=\"row\">\r\n\t\t\t\t\t\t<div class=\"span3\">\r\n\t\t\t\t\t\t\t<div class=\"well sidebar-nav\">\r\n\t\t\t\t\t\t\t\t<ul class=\"nav nav-list\">\r\n\t\t\t\t\t\t\t\t\t<li><span id=\"router-status\" class=\"badge badge-important\"></span></li>\r\n\t\t\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"row\">\r\n\t\t\t\t\t\t<div class=\"span3\">\r\n\t\t\t\t\t\t\t<div class=\"well sidebar-nav\">\r\n\t\t\t\t\t\t\t\t<ul class=\"nav nav-list\">\r\n\t\t\t\t\t\t\t\t\t<li><a href=\"admin/payouts\" target=\"_blank\">View Payouts</a></li>\r\n\t\t\t\t\t\t\t\t\t<li><a id=\"archive\" href=\"#\">Archive Session</a></li>\r\n\t\t\t\t\t\t\t\t\t<li><a id=\"download\" href=\"admin/download\">Download Data</a></li>\r\n\t\t\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<!--\r\n\t\t\t\t\t<div class=\"row\">\r\n\t\t\t\t\t\t<div class=\"span3\">\r\n\t\t\t\t\t\t\t<div class=\"well sidebar-nav\">\r\n\t\t\t\t\t\t\t\t<div class=\"btn-group\">\r\n\t\t\t\t\t\t            <button type=\"button\" class=\"btn btn-primary\" id=\"set_group\" >Set Groups</button>\r\n\t\t\t\t\t\t            <button type=\"button\" class=\"btn btn-danger\"  id=\"set_period\">Start Period</button>\r\n\t\t\t\t\t\t        </div>\r\n\t\t\t\t\t\t    </div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t-->\r\n\t\t\t\t\t<div class=\"row\">\r\n\t\t\t\t\t\t<div class=\"span3\">\r\n\t\t\t\t\t\t\t<div class=\"well sidebar-nav\">\r\n\t\t\t\t\t\t\t\t<div class=\"btn-group\" data-toggle=\"buttons-radio\">\r\n\t\t\t\t\t              <button id=\"gsp-button\" type=\"button\" class=\"btn btn-large btn-primary\">GSP</button>\r\n\t\t\t\t\t              <button id=\"vcg-button\" type=\"button\" class=\"btn btn-large btn-primary\">VCG</button>\r\n\t\t\t\t\t            </div>\r\n\t\t\t\t\t\t    </div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"span9\">\r\n\t\t\t\t\t<div class=\"row\">\r\n\t\t\t\t\t\t<div class=\"span9\">\r\n\t\t\t\t\t\t\t<p>Subjects:</p>\r\n\t\t\t\t\t\t\t<table class=\"table table-bordered table-condensed table-striped\">\r\n\t\t\t\t\t\t\t\t<thead>\r\n\t\t\t\t\t\t\t\t<tr><th>ID</th><th>Group</th><th>Period</th><th style=\"width: 150px;\"></th></tr>\r\n\t\t\t\t\t\t\t\t</thead>\r\n\t\t\t\t\t\t\t\t<tbody id=\"subject-list\">\r\n\t\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"row\">\r\n\t\t\t\t\t\t<div class=\"span6\">\r\n\t\t\t\t\t\t\t<button id=\"start-session\" class=\"btn btn-success\">Start Session</button>\r\n\t\t\t\t\t\t\t<button id=\"refresh-subjects\" class=\"btn btn-info\" title=\"Attempt recover by refreshing all subject browsers\">Recover Session</button>\r\n\t\t\t\t\t\t\t<button id=\"reset-session\" class=\"btn btn-danger\">Reset Session</button>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"span3\">\r\n\t\t\t\t\t\t\t<div class=\"pull-right\">\r\n\t\t\t\t\t\t\t\t<button id=\"pause-session\" class=\"btn btn-warning\" disabled=\"disabled\">Pause</button>\r\n\t\t\t\t\t\t\t\t<button id=\"resume-session\" class=\"btn btn-primary\" disabled=\"disabled\">Resume</button>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"row\" style=\"padding-top:10px;\">\r\n\t\t\t\t\t  <div class=\"span6\">\r\n\t\t\t\t\t\t\t<button type=\"button\" class=\"btn btn-primary\" id=\"set_group\" >Set Groups</button>\r\n\t            <button type=\"button\" class=\"btn btn-success\"  id=\"set_period\">Start Period</button>\r\n\t\t\t\t\t  </div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"row\">\r\n\t\t\t\t<div class=\"span12\">\r\n\t\t\t\t\t<hr/>\r\n\t\t\t\t\t<p>Configuration:</p>\r\n\t\t\t\t\t<load-config></load-config>\r\n\t\t\t\t\t<div style=\"overflow: auto;\">\r\n\t\t\t\t\t\t<table class=\"config table table-bordered table-striped table-condensed\"></table>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\r\n\r\n\t</body>\r\n</html>\r\n", "admin_js": "Redwood.controller(\"AdminCtrl\", [\"$rootScope\", \"$scope\", \"Admin\", function($rootScope, $scope, ra) {\r\n    var Display = { //Display controller\r\n      initialize: function() {\r\n\r\n        console.log(ra);\r\n        var auction_type = \"GSP\";\r\n        var group_size = 4;\r\n        var new_period = 1;\r\n        \r\n        var new_keep = \"Subject-1@leeps.ucsc.edu\";\r\n        var group = 1;\r\n        \r\n        $(\"#gsp-button\").click(function() {\r\n        \tsetAuction = true;\r\n          auction_type = \"GSP\";\r\n          ra.trigger(\"change_auction_type\", {auction_type: \"GSP\"});\r\n          $(\"#vcg-button\").removeClass(\"active\");\r\n          \r\n        });\r\n        \r\n        $(\"#vcg-button\").click(function() {\r\n        \tsetAuction = true;\r\n          auction_type = \"VCG\";\r\n          ra.trigger(\"change_auction_type\", {auction_type: \"VCG\"});\r\n          $(\"#gsp-button\").removeClass(\"active\");\r\n          \r\n        });\r\n        \r\n        $(\"#start-session\").click(function () {\r\n          \r\n        \tif (!setGroups) {\r\n        \t\talert(\"Please set groups before starting the experiment!\");\r\n        \t\treturn;\r\n        \t}\r\n        \tif (!setAuction) {\r\n        \t\talert(\"Please set the auction type before starting the experiment!\");\r\n        \t\treturn;\r\n        \t}\r\n          $(\"#start-session\").attr(\"disabled\", \"disabled\");\r\n          ra.trigger(\"start_session\");\r\n          new_period++;\r\n          $(\"#set_period\").html(\"Start Period: \" + new_period);\r\n        });\r\n  \r\n        ra.on(\"start_session\", function() {\r\n          $(\"#start-session\").attr(\"disabled\", \"disabled\");\r\n          $(\"#pause-session\").removeAttr(\"disabled\");\r\n        });\r\n  \r\n        $(\"#refresh-subjects\").click(function () {\r\n          $(\"#refresh-subjects\").attr(\"disabled\", \"disabled\");\r\n          ra.refreshSubjects().then(function() {\r\n            $(\"#refresh-subjects\").removeAttr(\"disabled\");\r\n          });\r\n        });\r\n  \r\n        $(\"#reset-session\").click(function () {\r\n          ra.reset();\r\n        });\r\n  \r\n        $(\"#pause-session\").click(function () {\r\n          $(\"#pause-session\").attr(\"disabled\", \"disabled\");\r\n          ra.trigger(\"pause\");\r\n        });\r\n        ra.on(\"pause\", function() {\r\n          $(\"#pause-session\").attr(\"disabled\", \"disabled\");\r\n        });\r\n  \r\n        $(\"#resume-session\").click(function () {\r\n          $(\"#resume-session\").attr(\"disabled\", \"disabled\");\r\n          ra.trigger(\"resume\");\r\n        });\r\n        ra.on(\"resume\", function() {\r\n          $(\"#resume-session\").attr(\"disabled\", \"disabled\");\r\n          $(\"#pause-session\").removeAttr(\"disabled\");\r\n        });\r\n  \r\n        ra.on_subject_paused(function(userId) {\r\n          $(\"#pause-session\").attr(\"disabled\", \"disabled\");\r\n          $(\"tr.subject-\" + userId).addClass(\"warning\"); //Display current period for each user\r\n          $(\"tr.subject-\" + userId + \" :nth-child(4)\").text(\"Paused\"); //Display current period for each user\r\n        });\r\n  \r\n        ra.on_all_paused(function() {\r\n          $(\"#resume-session\").removeAttr(\"disabled\");\r\n        });\r\n  \r\n        ra.on_subject_resumed(function(user) {\r\n          $(\"tr.subject-\" + user).removeClass(\"warning\"); //Display current period for each user\r\n          $(\"tr.subject-\" + user + \" :nth-child(4)\").text(\"\"); //Display current period for each user\r\n        });\r\n  \r\n        $(\"#archive\").click(function () {\r\n          var r = confirm(\"Are you sure you want to archive this session?\");\r\n          if(r == true) {\r\n            ra.delete_session();\r\n          }\r\n        });\r\n        \r\n\t  \t\t//$(\"#auction_type_modal\").modal({});\r\n\t  \r\n\t\t\t      \r\n\t\t\t$(\"#set_group\").click(function() {\r\n\t\t\t  ra.trigger(\"do_lottery\");\r\n\t\t\t  //resetGroups();\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#set_period\").click(function() {\r\n\t\t\t  \tif(new_period !== 0 && new_period !== undefined && new_period !== null && ra.subjects.length > 0){\r\n\t\t\t\t    //do_lottery();\r\n\t\t\t\t   \tfor(var i = 0, l = ra.subjects.length; i < l; i++) {\r\n\t\t              ra.set_period(new_period, ra.subjects[i].user_id);\r\n\t\t            }\r\n\t\t\t\t    ++new_period;\r\n\t\t\t   }\r\n\t\t\t   $(\"#set_period\").html(\"Start Period: \" + new_period);\r\n\t  \t});\r\n\t  \t\t\r\n\t\t\tra.on_router_connected(function(connected) { //Display router connection status\r\n\t\t\t\tvar status = $(\"#router-status\");\r\n\t\t\t\tif (connected) {\r\n\t\t\t\t\tstatus.text(\"Router Connected\");\r\n\t\t\t\t\tstatus.removeClass(\"badge-important\");\r\n\t\t\t\t\tstatus.addClass(\"badge-success\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\tstatus.text(\"Router Disconnected\");\r\n\t\t\t\t\tstatus.removeClass(\"badge-success\");\r\n\t\t\t\t\tstatus.addClass(\"badge-important\");\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t  \tra.on_set_period(function(user, period) {\r\n\t\t\t\t$(\"tr.subject-\" + user + \" :nth-child(3)\").text(period); //Display current period for each user\r\n\t\t\t});\r\n\r\n\t\t\tra.on_set_group(function(user, group) {\r\n\t\t\t\t$(\"tr.subject-\" + user + \" :nth-child(2)\").text(group); //Display group for each user\r\n\t\t\t});\r\n\r\n\t  \tra.on_set_config(function(config) { //Display the config file\r\n\t\t\t\t$(\"table.config\").empty();\r\n\t\t\t\tvar a = $.csv.toArrays(config);\r\n\t\t\t\tfor (var i = 0; i < a.length; i++) {\r\n\t\t\t\t\tvar row = a[i];\r\n\t\t\t\t\tvar tr = $(\"<tr>\");\r\n\t\t\t\t\tfor (var j = 0; j < row.length; j++) {\r\n\t\t\t\t\t\tvar cell = row[j];\r\n\t\t\t\t\t\tvar td = $((i == 0 ? \"<th>\" : \"<td>\")).text(cell);\r\n\t\t\t\t\t\ttr.append(td);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t$(\"table.config\").append(tr);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tra.on_register(function(user) { //Add a row to the table to each user\r\n\t\t\t\t$(\"#subject-list\").empty();\r\n\t\t\t\tfor(var i = 0, l = ra.subjects.length; i < l; i++) {\r\n\t\t\t\t\t$(\"#subject-list\").append($(\"<tr>\").addClass(\"subject-\" + ra.subjects[i].user_id).append(\r\n\t\t\t\t\t\t$(\"<td>\").text(ra.subjects[i].user_id).after(\r\n\t\t\t\t\t\t\t$(\"<td>\").text(0).after(\r\n\t\t\t\t\t\t\t\t$(\"<td>\").text(0).after(\r\n\t\t\t\t\t\t\t\t\t$(\"<td>\").text(\"\"))))));\r\n\t\t\t\t}\r\n\t\t\t\tra.trigger(\"do_lottery\");\r\n\t\t\t});\r\n  \t\t}\r\n  \t};\r\n\r\n  \tvar resetGroups = function() {\r\n\t\tvar config = ra.get_config(1, 0) || {};\r\n\t\tfor (var i = 0; i < ra.subjects.length; i++) { //set all subjects to group 1 (this is so that matching can be changed per period)\r\n\t\t\tif($.isArray(config.groups)) {\r\n\t\t\t\tfor(var groupId = 0; groupId < config.groups.length; groupId++) {\r\n\t\t\t\t\tif($.isArray(config.groups[groupId])) {\r\n\t\t\t\t\t\tif(config.groups[groupId].indexOf(parseInt(ra.subjects[i].user_id)) > -1) { //Nested group array\r\n\t\t\t\t\t\t\tra.set_group(groupId + 1, ra.subjects[i].user_id);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tra.set_group(1, ra.subjects[i].user_id);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tra.set_group(1, ra.subjects[i].user_id);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tDisplay.initialize();\r\n\r\n\tra.on_load(function () {\r\n\t\tresetGroups(); //Assign groups to users\r\n\t});\r\n\r\n\tra.on_register(function(user) { //Add a row to the table to each user\r\n\t\tresetGroups();\r\n\t});\r\n\r\n\tra.on(\"start_session\", function() {\r\n\t\tra.start_session();\r\n\t});\r\n\r\n\tra.on(\"pause\", function() {\r\n\t\tra.pause();\r\n\t});\r\n\r\n\tra.on(\"resume\", function() {\r\n\t\tra.resume();\r\n\t});\r\n\r\n\tvar auction_type = \"GSP\";\r\n\tvar group_size = 4;\r\n\tvar new_period = 2;\r\n  \tvar group = 1;\r\n  \tvar setGroups = false; //Makes sure the admin clicks set groups before starting the game.\r\n  \tvar setAuction = false;\r\n\t/*\r\n\t* randomly select subjects to be part of a new group\r\n\t*/\r\n\tra.on(\"do_lottery\" , function () {\r\n\t\tsetGroups = true;\r\n\t    var i = 0;\r\n\t    var tmp = [];\r\n\t    \r\n\t    for(var i = 0, l = ra.subjects.length; i < l; i++) {\r\n\t      var subj = {};\r\n\t      subj.userid = ra.subjects[i].user_id;\r\n\t      subj.a = 0;\r\n\t      tmp.push(subj);\r\n\t    }\r\n\r\n\t    \r\n\t    var curr_group = 1;\r\n\t    var count = 0;\r\n\t    while(count != tmp.length){\r\n\t      var rand = Math.floor(Math.random() * (tmp.length));\r\n\t      if(tmp[rand].a === 0){\r\n\t        tmp[rand].a = 1;\r\n\t        \r\n\t        ra.set_group(curr_group, tmp[rand].userid);\r\n\t        count++;\r\n\t        if((count % group_size === 0) && count !== 0) curr_group++;\r\n\t      }\r\n\t    }\r\n\t});\r\n\r\n}]);\r\n", "rt_js": ""}, "model": "expecon.experiment", "pk": 9}, {"fields": {"experiment": 9, "html": "{% load verbatim %}\r\n<!DOCTYPE HTML>\r\n<html ng-app=\"Redwood\">\r\n\t<head>\r\n\t\t<title>Wait</title>\r\n\r\n\t\t<script type=\"text/javascript\" src=\"{{ STATIC_URL }}framework/js/lib/jquery/jquery.min.js\"></script>\r\n\t\t<script type=\"text/javascript\" src=\"{{ STATIC_URL }}framework/js/lib/bootstrap/bootstrap-3.1.1.min.js\"></script>\r\n\t\t<script type=\"text/javascript\" src=\"{{ STATIC_URL }}framework/js/lib/angular/angular-1.2.16.js\"></script>\r\n\t\t<script type=\"text/javascript\" src=\"{{ STATIC_URL }}framework/js/redwoodCore.js\"></script>\r\n\t\t<script type=\"text/javascript\" src=\"{{ STATIC_URL }}framework/js/redwoodHelpers.js\"></script>\r\n\t\t<script type=\"text/javascript\" src=\"{{ STATIC_URL }}framework/js/redwoodSubject.js\"></script>\r\n\t\t<link type=\"text/css\" rel=\"stylesheet\" href=\"{{ STATIC_URL }}framework/css/bootstrap-3.1.1.min.css\"/>\r\n\t\t<script type=\"text/javascript\">\r\n\t\t\t{{ js }}\r\n\t\t</script>\r\n\t\t<style type=\"text/css\">\r\n\t\t\t{{ css }}\r\n\t\t</style>\r\n\t</head>\r\n{% verbatim %}\r\n\t<body ng-controller=\"SubjectCtrl\">\r\n\t\t\r\n\t\t<div class=\"navbar navbar-fixed-top container\">\r\n\t\t\t<div class=\"navbar navbar-default\" style=\"margin-bottom: 0;\">\r\n\t\t\t\t<div class=\"navbar-brand\" href=\"#\">Economics Experiment</div>\r\n\t\t\t\t<ul class=\"nav navbar-nav\">\r\n\t\t\t\t\t<li class=\"active\">\r\n\t\t\t\t\t\t<a>User ID: <span>{{ $root.user_id }}</span></a>\r\n\t\t\t\t\t</li>\r\n\t\t\t\t</ul>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t\r\n\t\t<div class=\"container\">\r\n\t\t\t<div class=\"row\">\r\n\t\t\t\t<div class=\"col-lg-12\">\r\n\t\t\t\t\tPlease wait for experiment to start...\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</body>\r\n{% endverbatim %}\r\n</html>\r\n\r\n", "name": "Wait", "css": "body {\r\n  padding-top: 60px;\r\n}\r\n\r\n", "js": "Redwood.controller(\"SubjectCtrl\", [\"$rootScope\", \"$scope\", \"RedwoodSubject\", function($rootScope, $scope, rs) {\r\n\trs.on_load(function() {\r\n\t\trs.next_period();\r\n\t});\r\n}]);\r\n\r\n"}, "model": "expecon.page", "pk": 46}, {"fields": {"experiment": 9, "html": "{% load verbatim %}\r\n<!DOCTYPE HTML>\r\n<html ng-app=\"Redwood\">\r\n  <head>\r\n    <title>Start</title>\r\n\r\n\t\t<script type=\"text/javascript\" src=\"{{ STATIC_URL }}framework/js/lib/jquery/jquery.min.js\"></script>\r\n\t\t<script type=\"text/javascript\" src=\"{{ STATIC_URL }}framework/js/lib/bootstrap/bootstrap-3.1.1.min.js\"></script>\r\n\t\t<script type=\"text/javascript\" src=\"{{ STATIC_URL }}framework/js/lib/angular/angular-1.2.16.js\"></script>\r\n\t\t<script type=\"text/javascript\" src=\"{{ STATIC_URL }}framework/js/redwoodCore.js\"></script>\r\n\t\t<script type=\"text/javascript\" src=\"{{ STATIC_URL }}framework/js/redwoodHelpers.js\"></script>\r\n\t\t<script type=\"text/javascript\" src=\"{{ STATIC_URL }}framework/js/redwoodSubject.js\"></script>\r\n    <script type=\"text/javascript\" src=\"{{ STATIC_URL }}framework/js/synchronizedStopWatch.js\"></script>\r\n    \r\n    <script language=\"javascript\" type=\"text/javascript\" src=\"{{ STATIC_URL}}framework/js/lib/flot/jquery.flot.js\"></script>\r\n    <script language=\"javascript\" type=\"text/javascript\" src=\"{{ STATIC_URL}}framework/js/lib/flot/jquery.flot.selection.js\"></script>\r\n    \r\n    <script src=\"{{ STATIC_URL}}experiments/AdAuction/simple-slider.js\"></script>\r\n    <link href=\"{{ STATIC_URL}}experiments/AdAuction/simple-slider.css\" rel=\"stylesheet\" type=\"text/css\" />\r\n    <link href=\"{{ STATIC_URL}}experiments/AdAuction/simple-slider-volume.css\" rel=\"stylesheet\" type=\"text/css\" />\r\n\t\t\r\n    <link type=\"text/css\" rel=\"stylesheet\" href=\"{{ STATIC_URL }}framework/css/bootstrap-3.1.1.min.css\"></link>\r\n\t\t<script type=\"text/javascript\">\r\n\t\t\t{{ js }}\r\n\t\t</script>\r\n\t\t<style type=\"text/css\">\r\n\t\t\t{{ css }}\r\n\t\t</style>\r\n\t</head>\r\n{% verbatim %}\r\n\t<body ng-controller=\"SubjectCtrl\">\r\n    <div class='container'>\r\n  \t\t<!-- Modal -->\r\n      <div class=\"modal fade\" id=\"myModal\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"myModalLabel\" aria-hidden=\"true\">\r\n      \r\n        <div class=\"modal-dialog\">\r\n          <div class=\"modal-content\"> \r\n            <div class=\"modal-body\">\r\n              <p>Please wait... A new round will begin shortly.</p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      \r\n  \t\t<div class=\"navbar navbar-fixed-top container\">\r\n  \t\t\t<div class=\"navbar navbar-default\" style=\"margin-bottom: 0;\">\r\n  \t\t\t\t<div class=\"navbar-brand\" href=\"#\">Economics Experiment</div>\r\n  \t\t\t\t<ul class=\"nav navbar-nav\" id = \"nav\">\r\n  \t\t\t\t\t<li class=\"active\">\r\n  \t\t\t\t\t\t<a>User ID: <span>{{ $root.user_id }}</span></a>\r\n  \t\t\t\t\t</li>\r\n  \t\t\t\t</ul>\r\n  \t\t\t</div>\r\n  \t\t</div>\r\n  \t\t\r\n  \t\t<div class=\"row marketing\" align=\"center\">\r\n        <div class=\"span6\">\r\n          \r\n          \r\n          <div class=\"progress\" style=\"text-align: left;\">\r\n            <div id=\"progressbar\" class=\"progress-bar progress-bar-striped active\" style=\"width: 0%\"></div>\r\n          </div>\r\n          <h2 id=\"adv_slot\" align = \"left\"></h4>\r\n\r\n\r\n          <div class='row'>\r\n            <div class='col-md-2'>\r\n              <div class=\"well\">\r\n                  <h4 id=\"vpc_slot\" align = \"left\">Value Per Item: -</h4>\r\n                  <hr>\r\n                  <h4 id=\"all_vpc\" align = \"left\">Others' Values Per Item: -</h4>\r\n                  <hr>\r\n                  <h4 id=\"ctr_slot\" align = \"left\">Items per Bundle: -</h4>\r\n                  <hr>\r\n                  <h4 id=\"time_slot\" align = \"left\">Time Remaining: </h4>\r\n                  <hr>\r\n                  <h4 id=\"pay_slot\" align = \"left\">Cumulative Payoff: </h4>\r\n                  <hr>\r\n                  <h4 id=\"timekeeper\" align = \"left\"></h4>\r\n                  <hr>\r\n                  <h3 id=\"error\"></h3>\r\n                  <hr>\r\n                  <h3 id=\"p_bid\"></h3>\r\n              </div>\r\n            </div>\r\n            <div class='col-md-4'>\r\n              <div class=\"demo-container\" >\r\n                      <div id=\"placeholder\" style=\"height:550px; width:100%\" class=\"demo-placeholder\">  </div>\r\n                  </div>\r\n                  <h4 align = \"center\"> Bid Amount</h4>\r\n                  <div class='slider-wrapper'>\r\n                    <input id=\"slider\" data-slider=\"true\" data-slider-range=\"0,100\">\r\n                  </div>\r\n                  \r\n                  <p align=\"left\"> Move slider to set a bid amount &shy; &shy; &shy; &shy;\r\n                  <input id=\"bidamnt\" type=\"integer\" value=\"\" style=\"text-align: right; width:3em\" onkeyup=\"if (event.keyCode == 13) document.getElementById('sub_bid').click()\"> <span id=\"bidamnt\">\r\n\r\n                  <button input id=\"sub_bid\" type=\"button\">Bid</button></p>\r\n                  <input id=\"hbid\" type=\"integer\" value=\"\" style=\"text-align: right; width:3em; display: none;\"> <span id=\"hbid\">\r\n                  <h3 align=\"left\" id=\"notice\"></h3>\r\n                  <p align=\"left\">\r\n                  </p>\r\n                  \r\n            </div>\r\n            <div class='col-md-1' id='payoffdiv'>\r\n              <h4>&shy;&shy; Payoff  &shy;&shy; </h4>\r\n                  <p id = \"arrow\" style=\"padding-top: 275px;\">\r\n                    <img border=\"0\" src=\"http://econlab.ucsc.edu/redwood/static/slickgrid/images/arrow.png\" width=\"61\" height=\"76\">\r\n                  </p>\r\n                  <p id = \"arrow2\" style=\"padding-top: 275px;\">\r\n                      <img border=\"0\" src=\"http://econlab.ucsc.edu/redwood/static/slickgrid/images/spacer.png\" width=\"61\" height=\"76\">\r\n                  </p>\r\n            </div>\r\n            <div class='col-md-4'>\r\n              <div class=\"demo-container\" >\r\n                    <div id=\"placeholder2\" style=\"height:550px; width:100%\" class=\"demo-placeholder\">  </div>\r\n                  </div>\r\n                  <h4 align = \"center\"> Time </h4>\r\n                  <h4> &nbsp; </h4>\r\n            </div>\r\n          </div>\r\n                       \r\n          \r\n\r\n       \r\n        </div>\r\n      </div>\r\n    \r\n    \r\n    \r\n        <div class=\"footer\" align=\"center\">\r\n        </div>\r\n    \r\n    </div>\r\n\t</body>\r\n{% endverbatim %}\r\n</html>\r\n\r\n", "name": "Start", "css": "body {\r\n  padding-top: 60px;\r\n}\r\nh4 {\r\n  margin-top: 5px;\r\n  margin-bottom: 5px;\r\n  font-size: 14px;\r\n  display: table-cell;\r\n  vertical-align: center;\r\n}\r\n\r\n.slider {\r\n  width: 100%;\r\n  position: relative;\r\n  box-sizing: border-box;\r\n  min-height: 16px;\r\n  margin-left: 8px;\r\n  margin-right: 35px;\r\n}\r\n.slider-wrapper {\r\n  padding-top: 10px;\r\n  padding-bottom: 10px;\r\n  margin-right: 43px;\r\n}", "js": "Redwood.controller(\"SubjectCtrl\", [\"$rootScope\", \"$scope\", \"RedwoodSubject\", 'SynchronizedStopWatch', function($rootScope, $scope, rs, SynchronizedStopWatch) {\r\n\r\n    var tick_time = 1.5; //tick interval of 0.5s\r\n    var tend = 600; //number of ticks until game ends\r\n    var time = tend; //remaining time (deprecated as of 3/23)\r\n    var network = {}; //array of all bidders\r\n    var t = 0; //time\r\n\r\n    var just_started = true; //if player has made a move yet or not\r\n    var landscape_on = false; //display landscape/potential line\r\n    var vfc_for_all = false; //show vfc values of other subjects\r\n    var pot_line; //landscape/potential line for plotting\r\n\r\n    var max_bid; //max bid\r\n    var max_y = 1; //upper graph bound\r\n    var min_y = 0; //lower bound\r\n\r\n    var session_payoff_p = []; //postitive payoff for entire session\r\n    var session_payoff_n = []; //negative payoffs\r\n    var paid = 0;\r\n\r\n    var current_period; //current period\r\n    var ct_options; //continuous graph options\r\n    var flow_options; //flow graph options\r\n\r\n    var id = 999; //subject name\r\n    var time_keeper = 999; //who synchronizes times during rounds\r\n\r\n    var chosen = false; //checks when time keeper has been chosen\r\n    var totalBidders = 1; //var k\r\n    var last_bid; //last submitted bid for subject\r\n\r\n    //there is always one less slot than total number of bidders\r\n    var totalSlots = totalBidders - 1;\r\n\r\n    var current_slot; //subject's slot in ad array  \r\n\r\n    var ctr = []; //click through rate of slot i; var a_i\r\n    var pay; //payoff value for bidder k\r\n    var curr_rev; //current revenue being earned by bidder k\r\n\r\n    var vfc = []; //value for click for bidder k\r\n    var gsp = []; //gsp array\r\n    var vcg = []; //vcg array\r\n\r\n    var auction_func = GSP; // The function used to update costs\r\n    var opp_pay_vis_en;\r\n    var user_vfc;\r\n    var in_group = [];\r\n    var waiting = 1;\r\n\r\n    var redwood_debug = 0;\r\n\r\n    var throttler = 30;\r\n    var reservePrice = 0;\r\n\r\n    /*\r\n\t  bidder 'k'\r\n\t  slot 'i'\r\n\t  ctr at slot i 'a[i]'\r\n\t  value of click for bidder k 's[k]'\r\n\t*/\r\n\r\n    /*\r\n\t\tRuns GSP to calculate costs on bidders.\r\n\t\t-network.bidders position 0 is the top slot, decreasing\r\n\t\t-reserve price implementation as well\r\n\t*/\r\n\r\n    function GSP() {\r\n        var k = 0;\r\n        var i = 0;\r\n\r\n        while (k < network.bidders.length - 1) {\r\n            if (network.bidders[i + 1] === null) {\r\n\r\n            \tnetwork.bidders[k].cost = 0;\r\n\r\n            } else {\r\n\r\n            \tvar actualCost = Number(network.bidders[i].ctr * network.bidders[i + 1].bid).toPrecision(2);\r\n\r\n                var ind = Number(network.bidders[i].ctr * network.bidders[i + 1].bid).toString().indexOf('.');\r\n\r\n                if (ind == -1)\r\n                    network.bidders[k].cost = Number(network.bidders[i].ctr * network.bidders[i + 1].bid);\r\n                else\r\n                    network.bidders[k].cost = Number((network.bidders[i].ctr * network.bidders[i + 1].bid).toPrecision(ind + 2));\r\n\r\n                if (network.bidders[k].cost < 0) network.bidders[k].cost = 0;\r\n\r\n\r\n            \t//If the next player isn't allocated a slot, and the reserve price is set, then\r\n            \t// the cost is calculated using the reservePrice as the next players bid\r\n\r\n                if (network.bidders[i + 1].current_slot == -1 && reservePrice != 0) {\r\n                \tnetwork.bidders[k].cost = Number(network.bidders[k].ctr * reservePrice);\r\n            \t}\r\n\r\n            }\r\n            k++;\r\n            i++;\r\n        }\r\n    }\r\n\r\n\r\n    /*\r\n\t  b[i+1] = bid of bidder who won next-most desirable slot\r\n\t  a[i] = ctr of slot i\r\n\t*/\r\n\r\n    function VCG() {\r\n        for (var r = 0; r < network.bidders.length; r++) {\r\n            network.bidders[r].cost = Number(0);\r\n        }\r\n\r\n        for (var k = 0; k < network.bidders.length; k++) {\r\n            for (var i = k; i < network.bidders.length - 1; i++) {\r\n                if (network.bidders[i + 1].bid === null) {\r\n                    network.bidders[k].cost = 0;\r\n                } else if (network.bidders[i + 1].ctr === null) {\r\n                    network.bidders[k].cost += network.bidders[i].ctr * network.bidders[i + 1].bid;\r\n                } else {\r\n\r\n                \t//If the next player isn't allocated a slot, and the reserve price is set, then\r\n                \t// the cost is calculated using the reservePrice as the next players bid\r\n\r\n                \tif (network.bidders[i + 1].current_slot == -1 && reservePrice != 0) {\r\n                \t\tnetwork.bidders[k].cost += network.bidders[i].ctr * reservePrice -\r\n                        \tnetwork.bidders[i + 1].ctr * reservePrice;\r\n                \t} else {\r\n                    \tnetwork.bidders[k].cost += network.bidders[i].ctr * network.bidders[i + 1].bid -\r\n                        \tnetwork.bidders[i + 1].ctr * network.bidders[i + 1].bid;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /*\r\n     * returns the click through rate times the value per click assigned to bidders\r\n     */\r\n    function get_revenue(bidder) {\r\n        return Number(bidder.ctr * bidder.vfc);\r\n    }\r\n\r\n    //the payoff function is the difference between revenue and cost\r\n    function get_payoff(bidder) {\r\n        return Number(bidder.revenue - bidder.cost);\r\n    }\r\n\r\n    /*\r\n     * bubblesort of bids to determine their appropriate slot\r\n     * runs in O(n^2)\r\n     */\r\n    function update_slots() {\r\n        if (just_started) return;\r\n\r\n        var len = network.bidders.length;\r\n\r\n        for (var i = 0; i < len; ++i) {\r\n            for (var j = 0; j < ((len - 1) - i); ++j) {\r\n                if (network.bidders[(len - 1) - j].bid > network.bidders[(len - 1) - (j + 1)].bid) {\r\n                    var num = network.bidders[(len - 1) - (j + 1)];\r\n\r\n                    network.bidders[(len - 1) - (j + 1)] = network.bidders[(len - 1) - j];\r\n                    network.bidders[(len - 1) - j] = num;\r\n                }\r\n            }\r\n        }\r\n        for (var k = 0; k < network.bidders.length; ++k) {\r\n            if (network.bidders[k].bid < reservePrice) { //force any undefined values to 0\r\n                network.bidders[k].payoff = 0;\r\n                network.bidders[k].cost = 0;\r\n                network.bidders[k].ctr = 0;\r\n                network.bidders[k].revenue = 0;\r\n                network.bidders[k].current_slot = -1;\r\n            } else if (k == network.bidders.length - 1) {\r\n                network.bidders[k].payoff = 0;\r\n                network.bidders[k].cost = 0;\r\n                network.bidders[k].ctr = 0;\r\n                network.bidders[k].revenue = 0;\r\n                network.bidders[k].current_slot = k;\r\n            } else {\r\n                network.bidders[k].current_slot = k;\r\n                network.bidders[k].ctr = Number(ctr[ctr.length - 1 - k]);\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    /* returns subject's index in network */\r\n    function get_bidder_by_id(pid) {\r\n        var t;\r\n        for (var i = 0; i < network.bidders.length; ++i) {\r\n            if (network.bidders[i].name == pid) t = i;\r\n        }\r\n\r\n        return t;\r\n    }\r\n\r\n    /*\r\n     * replaces bid amount for specified subject\r\n     */\r\n    function replace_bid(id, val) {\r\n        var i = get_bidder_by_id(id);\r\n        network.bidders[i].bid = Number(val);\r\n    }\r\n\r\n    /* returns unsorted list of each subject's bid */\r\n    function get_all_bids() {\r\n        var tmp = [];\r\n        for (var i = 0; i < network.bidders.length; ++i) {\r\n            tmp[i] = network.bidders[i].bid;\r\n        }\r\n\r\n        return tmp;\r\n    }\r\n\r\n    function get_pot_vals() {\r\n        var ind = get_bidder_by_id(id);\r\n        var tmp = [];\r\n        for (var i = 0; i < ind; ++i) {\r\n            tmp.push(get_pot_pay(ind, i));\r\n        }\r\n        tmp.push(network.bidders[ind].payoff);\r\n\r\n        for (var j = network.bidders.length - 1; j > ind; --j) {\r\n            tmp.push(get_pot_pay_n(ind, i));\r\n        }\r\n\r\n        return tmp;\r\n    }\r\n\r\n    /* returns the potential payoff of a bidder at a new slot */\r\n    function get_pot_pay(i, j) {\r\n        return Number((network.bidders[i].vfc * network.bidders[j].ctr) - (network.bidders[j].bid * network.bidders[j].ctr));\r\n    }\r\n\r\n    function get_pot_pay_n(i, j) {\r\n        return Number((network.bidders[i].vfc * network.bidders[j].ctr) - (network.bidders[j + 1].bid * network.bidders[j].ctr));\r\n    }\r\n        /* returns array of points to be plotted to generate player's potential line */\r\n    function horizon_line() {\r\n        var tmp = [];\r\n        var index = get_bidder_by_id(id);\r\n        var len = network.bidders.length - 1;\r\n        var a = network.bidders.length - 1;\r\n\r\n        if (index == a) {\r\n            --a;\r\n            tmp.push([0, network.bidders[len].payoff]);\r\n            tmp.push([network.bidders[len - 1].bid, network.bidders[len].payoff]);\r\n            tmp.push([network.bidders[len - 1].bid, ]);\r\n        }\r\n\r\n\r\n        for (var i = a; i > index; --i) {\r\n            if (i == len) {\r\n                tmp.push([0, network.bidders[len].payoff]);\r\n                tmp.push([network.bidders[len].bid, network.bidders[len].payoff]);\r\n                tmp.push([network.bidders[len].bid, ]);\r\n            } else {\r\n                tmp.push([network.bidders[i + 1].bid, get_pot_pay_n(index, i)]);\r\n                tmp.push([network.bidders[i].bid, get_pot_pay_n(index, i)]);\r\n                tmp.push([network.bidders[i].bid, ]);\r\n            }\r\n        }\r\n\r\n        if (index !== 0 && index != len) {\r\n            tmp.push([network.bidders[i + 1].bid, network.bidders[i].payoff]);\r\n            tmp.push([network.bidders[i - 1].bid, network.bidders[i].payoff]);\r\n            tmp.push([network.bidders[i - 1].bid, ]);\r\n        }\r\n\r\n        for (var j = index - 1; j >= 0; --j) {\r\n            if (j == 0) {\r\n                tmp.push([network.bidders[j].bid, get_pot_pay(index, j)]);\r\n                tmp.push([max_bid, get_pot_pay(index, j)]);\r\n            } else {\r\n                tmp.push([network.bidders[j].bid, get_pot_pay(index, j)]);\r\n                tmp.push([network.bidders[j - 1].bid, get_pot_pay(index, j)]);\r\n                tmp.push([network.bidders[j - 1].bid, ]);\r\n            }\r\n        }\r\n\r\n        if (index == 0) {\r\n            tmp.push([network.bidders[1].bid, network.bidders[0].payoff]);\r\n            tmp.push([max_bid, network.bidders[0].payoff]);\r\n        }\r\n\r\n        return tmp;\r\n    }\r\n\r\n    /* calculate remaining time and display on screen */\r\n    function print_time() {\r\n        var tmp_time = (tend - t) / 2; //t increments every 0.5s\r\n        var sec, min;\r\n\r\n        sec = Math.floor(tmp_time % 60);\r\n        min = Math.floor(tmp_time / 60);\r\n        if (t <= tend) document.getElementById(\"time_slot\").innerHTML = \"Time Remaining: \" + min + \" Minutes \" + sec + \" Seconds\";\r\n\r\n        /* update progress bar */\r\n        var percentage = (t / tend) * 100;\r\n\r\n        $(\"#progressbar\").width(percentage.toString() + \"%\");\r\n\r\n    }\r\n\r\n    /* return integral of flow payoff */\r\n    function get_session_points() {\r\n        var sum = 0;\r\n\r\n        for (var i = 0; i < session_payoff_p.length; ++i) {\r\n            if (!isNaN(session_payoff_p[i][1])) sum += Number(session_payoff_p[i][1]);\r\n        }\r\n\r\n        for (var j = 0; j < session_payoff_n.length; ++j) {\r\n            if (!isNaN(session_payoff_n[j][1])) sum += Number(-1 * Math.abs(session_payoff_n[j][1]));\r\n        }\r\n\r\n        return Math.floor(sum / tend);\r\n    }\r\n\r\n\r\n    /* returns the highest max_y value since start of round */\r\n    function get_max_y(session_payoff_p, session_payoff_n) {\r\n        var m = 0;\r\n        var i;\r\n        for (i = 0; i < session_payoff_p.length; ++i)\r\n            if (session_payoff_p[i][1] > m) m = session_payoff_p[i][1];\r\n\r\n        var j;\r\n        for (j = 0; j < session_payoff_n.length; ++j)\r\n            if (Math.abs(session_payoff_n[j][1]) > m) m = Math.abs(session_payoff_n[j][1]);\r\n\r\n        return m;\r\n    }\r\n\r\n    /* recalculate graph data for all functions */\r\n    function update_data() {\r\n\r\n        for (var i = 0; i < network.bidders.length; ++i) {\r\n            network.bidders[i].revenue = get_revenue(network.bidders[i]);\r\n            network.bidders[i].payoff = get_payoff(network.bidders[i]);\r\n        }\r\n        auction_func();\r\n    }\r\n\r\n\r\n    rs.on_load(function() {\r\n        rs.send(\"config\", {});\r\n\r\n        $scope.clock = SynchronizedStopWatch.instance()\r\n            .frequency(tick_time).onTick(tick)\r\n            .duration(rs.config.tend).onComplete(function() {\r\n                rs.next_period(5);\r\n            });\r\n\r\n        $scope.clock.start();\r\n\r\n        //prevent user input while period syncs up\r\n        $('#myModal').modal({\r\n            backdrop: 'static',\r\n            keyboard: false\r\n        });\r\n        $(\"#myModal\").modal('show');\r\n\r\n        id = rs.user_id;\r\n        if (!chosen) {\r\n            time_keeper = rs.subjects[0].user_id;\r\n        }\r\n        chosen = true;\r\n        group_num = rs._group;\r\n\r\n        num_of_bidders = rs.subjects.length;\r\n\r\n        for (var i = 0, l = rs.subjects.length; i < l; i++) {\r\n            in_group.push(parseInt(rs.subjects[i].user_id));\r\n        }\r\n\r\n        num_of_players = in_group.length;\r\n\r\n        totalSlots = num_of_bidders - 1;\r\n\r\n        network.bidders = [];\r\n        vfc = rs.config.vfc;\r\n        vfc = vfc.split(\",\");\r\n        ctr = rs.config.ctr;\r\n        ctr = ctr.split(\",\");\r\n\r\n        //initialize arrays to predefined values\r\n        for (var i = 0; i < num_of_bidders; ++i) {\r\n            gsp[i] = 0;\r\n            vcg[i] = 0;\r\n\r\n            var bidder = {};\r\n            bidder.name = in_group[i];\r\n            bidder.current_slot = -1;\r\n            bidder.bid = 0;\r\n            bidder.revenue = 0;\r\n            bidder.cost = 0;\r\n            bidder.payoff = 0;\r\n            //bidder.group = r.group;\r\n\r\n            if (vfc[i] === undefined) bidder.vfc = 1;\r\n            else bidder.vfc = Number(vfc[i]);\r\n\r\n            if (ctr[i] === undefined) bidder.ctr = 1;\r\n            else bidder.ctr = Number(ctr[i]);\r\n\r\n            network.bidders.push(bidder);\r\n        }\r\n\r\n        current_period = rs.period;\r\n\r\n\r\n\r\n        /* get new bid from input box */\r\n        $(\"#sub_bid\").click(function() {\r\n            var input = document.getElementById('bidamnt').value;\r\n            document.getElementById('hbid').value = input;\r\n            if (input != last_bid) {\r\n                var tmp;\r\n                /* check for valid bid */\r\n                //if(input !== null && input > 0 && last_bid != input) { \r\n                if (input !== null && last_bid != input && input <= max_bid) {\r\n                    last_bid = input;\r\n                    var new_bid = last_bid;\r\n                    just_started = false;\r\n                    rs.send(\"replace_bids\", {\r\n                        new_bid: new_bid,\r\n                        id: id\r\n                    });\r\n                    rs.trigger(\"replace_my_bid\", {\r\n                        new_bid: new_bid,\r\n                        id: id\r\n                    });\r\n                }\r\n                flow_options.xaxis.ticks = [0, reservePrice, user_vfc, last_bid, max_bid];\r\n                $(\"[data-slider]\").simpleSlider(\"setValue\", input);\r\n                update_flow_graph();\r\n            }\r\n        });\r\n\r\n        $(\"[data-slider]\").each(function() {\r\n            var inthis = $(this);\r\n            $(\"<span>\").addClass(\"output\").insertAfter($(this));\r\n        }).bind(\"slider:ready slider:changed\", throttle(function(event, data) {\r\n            var input = data.value.toFixed(2);\r\n            if (input !== null && input <= max_bid && t <= tend) {\r\n                last_bid = input;\r\n                var new_bid = last_bid;\r\n                just_started = false;\r\n                rs.send(\"replace_bids\", {\r\n                    new_bid: new_bid,\r\n                    id: id\r\n                });\r\n                rs.trigger(\"replace_my_bid\", {\r\n                    new_bid: new_bid,\r\n                    id: id\r\n                });\r\n            }\r\n            flow_options.xaxis.ticks = [0, reservePrice, user_vfc, last_bid, max_bid];\r\n            document.getElementById('bidamnt').value = last_bid;\r\n            update_flow_graph();\r\n        }, throttler));\r\n\r\n        function throttle(func, interval) {\r\n            var lastCallz = 0;\r\n            return function() {\r\n                var nowz = Date.now();\r\n                if (lastCallz + interval < nowz) {\r\n                    lastCallz = nowz;\r\n                    return func.apply(this, arguments);\r\n                }\r\n            };\r\n        }\r\n    });\r\n\r\n    function update_flow_graph() {\r\n\r\n        var subj_pos = [];\r\n        //get all other subjects' positions\r\n        for (var i = 0; i < network.bidders.length; ++i) {\r\n            if (opp_pay_vis_en) {\r\n                if (network.bidders[i].name != id) {\r\n                \tsubj_pos[i] = [network.bidders[i].bid, network.bidders[i].payoff];\r\n                }\r\n            } else if (!opp_pay_vis_en) {\r\n                if (network.bidders[i].name != id) {\r\n                \tsubj_pos[i] = [network.bidders[i].bid, 0];\r\n                } \r\n            }\r\n        }\r\n\r\n\r\n        console.log(\"reservePrice = \" + reservePrice);\r\n        var reserveBidder = [];\r\n        reserveBidder[0] = [ Number(reservePrice), 0];\r\n\r\n        console.log(reserveBidder);\r\n        console.log(pot_line);\r\n        console.log(subj_pos);\r\n\r\n        //keep track of last slider position\r\n        var bid_pos = [\r\n            [last_bid, network.bidders[get_bidder_by_id(id)].payoff]\r\n        ];\r\n\r\n        var flow_plot = $.plot($(\"#placeholder\"), [{\r\n            data: pot_line,\r\n            color: '#000000',\r\n            lines: {\r\n                show: true\r\n            }\r\n        }, {\r\n        \tdata: reserveBidder,\r\n        \tcolor: '#ffffff',\r\n            points: {\r\n                show: true,\r\n                radius: 8,\r\n                fill: true,\r\n                fillColor: '#ad0514'\r\n            }\r\n        }, {\r\n            data: subj_pos,\r\n            color: '#545454',\r\n            points: {\r\n                show: true,\r\n                radius: 8,\r\n                fill: true,\r\n                fillColor: '#ABABAB'\r\n            }\r\n        }, {\r\n            data: bid_pos,\r\n            color: '#545454',\r\n            points: {\r\n                show: true,\r\n                radius: 8,\r\n                fill: true,\r\n                fillColor: '#7AAE08'\r\n            }\r\n        }], flow_options);\r\n    }\r\n\r\n    function update_ct_graph() {\r\n\r\n        if (just_started) {\r\n            document.getElementById(\"arrow\").hidden = true;\r\n            document.getElementById(\"arrow2\").hidden = false;\r\n            session_payoff_p.push([t, 0]);\r\n        } else {\r\n            if (network.bidders[get_bidder_by_id(id)].payoff < 0) {\r\n                document.getElementById(\"arrow\").hidden = false;\r\n                document.getElementById(\"arrow2\").hidden = true;\r\n\r\n                if (Math.abs(network.bidders[get_bidder_by_id(id)].payoff) >= max_y) {\r\n                    flow_options.yaxis.max = Math.abs(network.bidders[get_bidder_by_id(id)].payoff) + Math.abs((network.bidders[get_bidder_by_id(id)].payoff * 0.05));\r\n                    ct_options.yaxis.max = Math.abs(network.bidders[get_bidder_by_id(id)].payoff) + Math.abs((network.bidders[get_bidder_by_id(id)].payoff * 0.05));\r\n                }\r\n\r\n                // we want negative payoffs to still be shown above the x axis\r\n                session_payoff_n.push([t, Math.abs(network.bidders[get_bidder_by_id(id)].payoff)]);\r\n                session_payoff_p.push([t, ]);\r\n            } else {\r\n                document.getElementById(\"arrow\").hidden = true;\r\n                document.getElementById(\"arrow2\").hidden = false;\r\n\r\n                if (network.bidders[get_bidder_by_id(id)].payoff >= max_y) {\r\n                    ct_options.yaxis.max = network.bidders[get_bidder_by_id(id)].payoff + (network.bidders[get_bidder_by_id(id)].payoff * 0.05);\r\n                    flow_options.yaxis.max = network.bidders[get_bidder_by_id(id)].payoff + (network.bidders[get_bidder_by_id(id)].payoff * 0.05);\r\n                }\r\n                session_payoff_p.push([t, Number(network.bidders[get_bidder_by_id(id)].payoff)]);\r\n                session_payoff_n.push([t, ]);\r\n            }\r\n        }\r\n\r\n        if (session_payoff_p.length > (t + 3)) {\r\n            for (var i = t; i < session_payoff_p.length; ++i)\r\n                session_payoff_p.pop();\r\n        }\r\n\r\n        var ct_plot = $.plot($(\"#placeholder2\"), [{\r\n            data: session_payoff_p,\r\n            color: '#009900'\r\n        }, {\r\n            data: session_payoff_n,\r\n            color: '#990000'\r\n        }], ct_options);\r\n\r\n    }\r\n\r\n    function get_payoffs() {\r\n        update_slots();\r\n        update_data();\r\n    }\r\n\r\n    function tick() {\r\n\r\n        if (waiting) return;\r\n        t++;\r\n\r\n        update_slots();\r\n        update_data();\r\n        add_points();\r\n\r\n        ct_options.xaxis.ticks = [0, t, tend];\r\n\r\n        if (t < tend) document.getElementById(\"pay_slot\").innerHTML = \"Cumulative Payoff \" + get_session_points();\r\n        print_time();\r\n\r\n\r\n        update_slots();\r\n        update_data();\r\n        update_flow_graph();\r\n        update_ct_graph();\r\n\r\n        if (id == time_keeper) {\r\n            rs.send(\"sync_time\", {\r\n                t: t\r\n            });\r\n            var tmp = network.bidders;\r\n            rs.send(\"sync_net\", {\r\n                tmp: tmp\r\n            });\r\n        }\r\n    }\r\n\r\n    function add_points() {\r\n        //rs.add_points(get_session_points());\r\n    }\r\n\r\n    /* have time keeper update all other subjects */\r\n    rs.recv(\"sync_net\", function(uid, msg) {\r\n        for (var i = 0; i < network.bidders.length; ++i) {\r\n            network.bidders[i] = msg.tmp[i];\r\n        }\r\n    });\r\n\r\n    rs.recv(\"update_points\", function(uid, msg) {\r\n        if (msg.points != null) points = msg.points;\r\n    });\r\n\r\n    rs.recv(\"sync_time\", function(uid, msg) {\r\n        t = msg.t;\r\n    });\r\n\r\n    rs.recv(\"pause\", function(uid, msg) {\r\n        waiting = 1;\r\n    });\r\n\r\n    rs.recv(\"unpause\", function(uid, msg) {\r\n        waiting = 0;\r\n    });\r\n\r\n    rs.recv(\"new_period\", function(uid, msg) {\r\n        waiting = 1;\r\n        if (paid) {\r\n            rs.add_points(get_session_points());\r\n        }\r\n        $(\"#myModal\").modal('show');\r\n        rs.next_period(5);\r\n    });\r\n\r\n    rs.recv(\"change_auction_type\", function(uid, msg) {\r\n        if (msg.auction_type == \"GSP\") {\r\n            auction_func = GSP;\r\n        } else if (msg.auction_type == \"VCG\") {\r\n            auction_func = VCG;\r\n        }\r\n    });\r\n\r\n    /* enter new subject bid */\r\n    rs.recv(\"replace_bids\", function(uid, msg) {\r\n        if (msg.new_bid !== null && msg.new_bid <= max_bid) {\r\n            replace_bid(msg.id, Number(msg.new_bid).toFixed(2));\r\n        }\r\n    });\r\n\r\n    rs.on(\"replace_my_bid\", function(msg) {\r\n        if (msg.new_bid !== null && msg.new_bid <= max_bid) {\r\n            replace_bid(msg.id, Number(msg.new_bid).toFixed(2));\r\n        }\r\n    });\r\n\r\n    rs.recv(\"override_sync\", function(uid, msg) {\r\n        if (msg.new_keep != \"\" && msg.new_keep != undefined && msg.new_keep != null && rs._group == msg.group)\r\n            time_keeper = msg.new_keep;\r\n    });\r\n\r\n    rs.recv(\"r_debug\", function(uid, msg) {\r\n\r\n        redwood_debug = msg.debug;\r\n        just_started = msg.start;\r\n    });\r\n\r\n    /* set up our config values */\r\n    rs.recv(\"config\", function(uid, msg) {\r\n        chosen = true;\r\n        tend = rs.config.tend;\r\n        max_y = rs.config.max_y;\r\n        min_y = rs.config.min_y;\r\n        vfc = rs.config.vfc;\r\n        vfc = vfc.split(\",\");\r\n        ctr = rs.config.ctr;\r\n        ctr = ctr.split(\",\");\r\n\r\n        max_bid = rs.config.max_bid;\r\n        landscape_on = rs.config.en_landscape;\r\n        vfc_for_all = rs.config.en_vfc;\r\n        reservePrice = rs.config.reserve;\r\n\r\n        ct_options = {\r\n            series: {\r\n                shadowSize: 0\r\n            },\r\n            lines: {\r\n                fill: true\r\n            },\r\n            yaxis: {\r\n                min: min_y,\r\n                max: max_y + 50,\r\n                ticks: 14\r\n            },\r\n            xaxis: {\r\n                min: 0,\r\n                max: tend\r\n            }\r\n        };\r\n\r\n        flow_options = {\r\n            series: {\r\n                shadowSize: 0,\r\n                lines: {\r\n                    show: false\r\n                }\r\n            },\r\n            yaxis: {\r\n                min: min_y,\r\n                max: max_y,\r\n                ticks: 14,\r\n                position: \"right\"\r\n            },\r\n            xaxis: {\r\n                min: 0,\r\n                max: max_bid,\r\n                ticks: [0, max_bid]\r\n            }\r\n        };\r\n\r\n        flow_options.xaxis.max = max_bid;\r\n        opp_pay_vis_en = rs.config.opp_pay_vis;\r\n        paid = rs.config.paid_session;\r\n        update_flow_graph();\r\n        update_ct_graph();\r\n\r\n        var len = network.bidders.length;\r\n        for (var i = 0; i < len; ++i) {\r\n            if (network.bidders[i].name === undefined) network.bidders.pop();\r\n        }\r\n\r\n        user_vfc = network.bidders[get_bidder_by_id(id)].vfc;\r\n        document.getElementById(\"vpc_slot\").innerHTML = \"Value per Item: \" + user_vfc;\r\n        flow_options.xaxis.ticks = [0, reservePrice, user_vfc, last_bid, max_bid];\r\n        if (vfc_for_all) document.getElementById(\"all_vpc\").innerHTML = \"Others' Values Per Item: \" + vfc;\r\n        document.getElementById(\"ctr_slot\").innerHTML = \"Items per Bundle: \" + ctr;\r\n\r\n        rs.send(\"setup\", {\r\n            chosen: chosen,\r\n            time_keeper: time_keeper\r\n        });\r\n    });\r\n\r\n    rs.recv(\"setup\", function(uid, msg) {\r\n\r\n        if (msg.chosen !== null) chosen = msg.chosen;\r\n        if (msg.time_keeper !== null) time_keeper = msg.time_keeper;\r\n        $(\"#myModal\").modal('hide');\r\n        waiting = 0;\r\n\r\n    });\r\n\r\n}]);"}, "model": "expecon.page", "pk": 47}, {"fields": {"experiment": 9, "html": "{% load verbatim %}\r\n<!DOCTYPE HTML>\r\n<html ng-app=\"Redwood\">\r\n\t<head>\r\n\t\t<title>Finish</title>\r\n\r\n\t\t<script type=\"text/javascript\" src=\"{{ STATIC_URL }}framework/js/lib/jquery/jquery.min.js\"></script>\r\n\t\t<script type=\"text/javascript\" src=\"{{ STATIC_URL }}framework/js/lib/bootstrap/bootstrap-3.1.1.min.js\"></script>\r\n\t\t<script type=\"text/javascript\" src=\"{{ STATIC_URL }}framework/js/lib/angular/angular-1.2.16.js\"></script>\r\n\t\t<script type=\"text/javascript\" src=\"{{ STATIC_URL }}framework/js/redwoodCore.js\"></script>\r\n\t\t<script type=\"text/javascript\" src=\"{{ STATIC_URL }}framework/js/redwoodHelpers.js\"></script>\r\n\t\t<script type=\"text/javascript\" src=\"{{ STATIC_URL }}framework/js/redwoodSubject.js\"></script>\r\n\t\t<link type=\"text/css\" rel=\"stylesheet\" href=\"{{ STATIC_URL }}framework/css/bootstrap-3.1.1.min.css\"></link>\r\n\t\t<script type=\"text/javascript\">\r\n\t\t\t{{ js }}\r\n\t\t</script>\r\n\t\t<style type=\"text/css\">\r\n\t\t\t{{ css }}\r\n\t\t</style>\r\n\t</head>\r\n{% verbatim %}\r\n\t<body ng-controller=\"SubjectCtrl\">\r\n\t\t\r\n\t\t<div class=\"navbar navbar-fixed-top container\">\r\n\t\t\t<div class=\"navbar navbar-default\" style=\"margin-bottom: 0;\">\r\n\t\t\t\t<div class=\"navbar-brand\" href=\"#\">Economics Experiment</div>\r\n\t\t\t\t<ul class=\"nav navbar-nav\">\r\n\t\t\t\t\t<li class=\"active\">\r\n\t\t\t\t\t\t<a>User ID: <span>{{ $root.user_id }}</span></a>\r\n\t\t\t\t\t</li>\r\n\t\t\t\t</ul>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t\r\n\t\t<div class=\"container\">\r\n\t\t\t<table class=\"table table-bordered table-condensed\">\r\n\t\t\t\t<thead>\r\n\t\t\t\t\t<tr><th>Period</th><th>Points</th></tr>\r\n\t\t\t\t</thead>\r\n\t\t\t\t<tbody id=\"results\">\r\n\t\t\t\t\t<tr ng-repeat=\"points in pointsByPeriod track by $index\">\r\n\t\t\t\t\t\t<td>{{ $index + 1 }}</td><td>{{ points | number:2 }}</td><td>${{ points | number:2 }}</td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t\t<tr class=\"warning\">\r\n\t\t\t\t\t\t<td>Average:</td><td>{{ ($root.totalPoints / ($root.period - 1) || 0) | number:2 }}</td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t\t<tr class=\"success\">\r\n\t\t\t\t\t\t<td>Total:</td><td>{{ $root.totalPoints | number:2 }}</td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</tbody>\r\n\t\t\t</table>\r\n\t\t</div>\r\n\t</body>\r\n{% endverbatim %}\r\n</html>\r\n\r\n", "name": "Finish", "css": "body {\r\n  padding-top: 60px;\r\n}\r\n\r\n", "js": "Redwood.controller(\"SubjectCtrl\", [\"$rootScope\", \"$scope\", \"RedwoodSubject\", function($rootScope, $scope, rs) {\r\n\t$scope.results = []\r\n\t\r\n\trs.on_load(function() {\r\n\t  console.log(rs);\r\n\t  var results = rs.subject[rs.user_id].data[\"results\"];\r\n\r\n    for (var i = 0; i < results.length; i++) {\r\n        \r\n        var result = results[i];\r\n\r\n        $scope.results[result.round] = {\r\n            round: result.round + 1,\r\n            stock: result.allocation.stock,\r\n            bond: result.allocation.bond,\r\n            returnFromBonds: result.returnFromBonds,\r\n            returnFromStocks: result.returnFromStocks,\r\n            isPracticeRound: result.isPracticeRound,\r\n            points: 0.0,\r\n            earnings: 0.0,\r\n            selected: false\r\n        };\r\n    }\r\n        \r\n\t\t$scope.pointsByPeriod = (rs.subject[rs.user_id].points_by_period() / 1000);\r\n\t\t$scope.pointsByPeriod.shift();\r\n\t});\r\n}]);\r\n\r\n"}, "model": "expecon.page", "pk": 48}]